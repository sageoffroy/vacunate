$.fn.extend {
  integrateSelect2: (selector)->
    selector = selector || '.select2'
    $(@).find(selector).select2({
      theme: "bootstrap",
      width: '100%',
      allowClear: false
    })

  integrateDatepicker: (selector)->
    selector = selector || '.datepicker'
    $(@).find(selector).datepicker({
      startView: 2,
      language: "es",
      orientation: "bottom auto",
      autoclose: true,
      clearBtn: true,
      dateFormat: "dd-mm-yyyy"
      endDate: "-4y"
      defaultViewDate: { year: 1980, month: 1, day: 1 }

    })
}



###
# Number.prototype.format(n, x, s, c)
#
# @param integer n: length of decimal
# @param integer x: length of whole part
# @param mixed   s: sections delimiter
# @param mixed   c: decimal delimiter
###

Number::format = (n, x, s, c) ->
  re = '\\d(?=(\\d{' + (x or 3) + '})+' + (if n > 0 then '\\D' else '$') + ')'
  num = @toFixed(Math.max(0, ~ ~n))
  (if c then num.replace('.', c) else num).replace new RegExp(re, 'g'), '$&' + (s or ',')

$(document).ready ->
  $('[data-toggle="tooltip"]').tooltip()
  form = $('form')
  form.integrateSelect2()
  form.integrateDatepicker()

  document.getElementById('person_phone').addEventListener 'input', (e) ->
    x = e.target.value.replace(/\D/g, '').match(/(\d{0,8})/)
    e.target.value = x[1]
    return

  document.getElementById('person_code_phone').addEventListener 'input', (e) ->
    x = e.target.value.replace(/\D/g, '').match(/(\d{0,4})/)
    e.target.value = x[1]
    return

  document.getElementById('person_dni').addEventListener 'input', (e) ->
    x = e.target.value.replace(/\D/g, '')
    e.target.value = x
    return
  



$(document).on 'turbolinks:load', ->
  $('[data-toggle="tooltip"]').tooltip()
  datatable = $('.datatable')
  datatable.DataTable
    'language': 'url': '//cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Spanish.json'
    'bPaginate': true
    'info': false
    'responsive': true
    'deferRender': true
    'stateSave': true

  form = $('form')
  form.integrateSelect2()
  form.integrateDatepicker()

  document.getElementById('person_phone').addEventListener 'input', (e) ->
    x = e.target.value.replace(/\D/g, '').match(/(\d{0,8})/)
    e.target.value = x[1]
    return

  document.getElementById('person_code_phone').addEventListener 'input', (e) ->
    x = e.target.value.replace(/\D/g, '').match(/(\d{0,4})/)
    e.target.value = x[1]
    return

  document.getElementById('person_dni').addEventListener 'input', (e) ->
    x = e.target.value.replace(/\D/g, '')
    e.target.value = x
    return



$ ->
  $('[data-toggle="tooltip"]').tooltip()



$(document).on 'turbolinks:before-cache', ->
    dataTable =  $($.fn.dataTable.tables(true)).DataTable()
    if (dataTable != null)
     dataTable.destroy();


