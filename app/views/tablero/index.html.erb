<div class="container">
  <div class="panel-pane pane-texto">
    <div class="pane-content">
      <div class="row my-2">
        <div class="col-md-12 col-sm-12 col-xs-12">
            <h3 class="">
                TABLERO 
            </h3>
        </div>

        <!-- Earnings (Monthly) Card Example -->
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-primary shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                    Total de Inscripciones
                  </div>
                  <div class="h5 mb-0 font-weight-bold text-gray-800">
                    <%=@total_de_inscripciones%>
                  </div>
                </div>
                <div class="col-auto">
                    <i class="fa fa-address-book fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Earnings (Monthly) Card Example -->
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-success shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                      Vacunados</div>
                  <div class="h5 mb-0 font-weight-bold text-gray-800"><%=@total_de_vacunados%></div>
                </div>
                <div class="col-auto">
                  <i class="fa fa-medkit fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Earnings (Monthly) Card Example -->
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-info shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                    Nuevos
                  </div>
                  <div class="row no-gutters align-items-center">
                    <div class="h5 mb-0 font-weight-bold text-gray-800">
                      <%=@total_nuevos%>
                    </div>
                  </div>
                </div>
                <div class="col-auto">
                  <i class="fa fa-medkit fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Pending Requests Card Example -->
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-left-warning shadow h-100 py-2">
            <div class="card-body">
              <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                  <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                    Ausentes
                  </div>
                  <div class="h5 mb-0 font-weight-bold text-gray-800">
                    <%=@total_ausentes%>
                  </div>
                </div>
                <div class="col-auto">
                  <i class="fa fa-comments fa-2x text-gray-300"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
    </div>

    <!-- Content Row -->
    <div class="row">

        <!-- Content Column -->
        <div class="col-lg-6 mb-4">

            <!-- Project Card Example -->
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">Localidades con más % de inscriptos</h6>
                </div>
                <div class="card-body">
              		<% @inscripciones_x_localidad.each do |loc| %>
              			<h4 class="small font-weight-bold"><%=loc[0].name%> <span class="float-right"><%=number_with_precision(loc[1].to_f / @total_de_inscripciones.to_f * 100,:precision => 2).to_s + '%'%></span></h4>
                  	<div class="progress mb-4">
                    	<div class="progress-bar bg-warning" role="progressbar" style="width: <%=(loc[1].to_f / @total_de_inscripciones.to_f * 100).to_s + '%'%>"
                      aria-valuenow="<%=(loc[1].to_f / @total_de_inscripciones.to_f * 100).to_s%>" aria-valuemin="0" aria-valuemax="100"></div>
                  	</div>
              		<% end %>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
          <div class="row">
            <div class="col-lg-12">
               <!-- Project Card Example -->
                <div class="card shadow mb-4">
                    <div class="card-header py-3">
                        <h6 class="m-0 font-weight-bold text-primary">Inscripciones con Patologías</h6>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-lg-6">
                                <%= image_tag "iconos_salud-02.png", style:"max-width:150px;" %>
                            </div>
                            <div class="col-lg-6" style="display: table;height: 150px;">
                                <span class="h1 text-warning" style="vertical-align:middle;display: table-cell;">
                                    <%=@inscripciones_patologia%>
                                </span>
                            </div>
                        </div>
                        <p> Cantidad de inscripciones con una o más patologías de Riesgo.</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
              <!-- Project Card Example -->
              <div class="card shadow mb-4">
                <div class="card-header py-3">
                  <h6 class="m-0 font-weight-bold text-primary">Generar Listado</h6>
                </div>
                <div class="card-body">
                  <div class="row">

                    <div class="col-md-12 form-group">
                      <%= label_tag "Localidad:" %>
                      <%= select_tag "select_locality_list", options_from_collection_for_select(@localities, :id, :to_s), :class=> 'select-field form-control', multiple: "multiple" %>
                    </div>
                    <div class="col-md-12 form-group">
                      <%= label_tag "Grupo Poblacional:" %>
                      <%= select_tag "population_group_list", options_for_select([ "Soy personal de salud", "Soy personal de seguridad", "Soy personal de educación", "Soy mayor de 60 años", "Tengo entre 18 y 59 (con factores de riesgo)","Tengo entre 18 y 59 (sin factores de riesgo)"]), {class: "select-field form-control", multiple: "multiple"}%>
                    </div>

                    <div class="col-md-12 form-group">
                      <%= label_tag "Edad Mínima" %>
                      <%= number_field_tag 'age_min', '18', {class:'form-control'}%>
                    </div>     

                    <div class="col-md-12 form-group">
                      <%= label_tag "Estado:" %>
                      <%= select_tag "state_list", options_for_select(["Nuevo", "Vacunado", "Ausente"]), {class: " select-field form-control", multiple: "multiple"}%>
                    </div>
                    <div class="col-md-12 form-group"> 
                      <a id="list_generator_button" class="btn btn-secondary btn-block">GENERAR LISTADO</a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-lg-12">
              <!-- Project Card Example -->
              <div class="card shadow mb-4">
                <div class="card-header py-3">
                  <h6 class="m-0 font-weight-bold text-primary">Actualización masiva de Estados</h6>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-12 form-group">  
                    <%= form_tag('/update_states') do %>
                        <div class="form-group">  
                          <%= label_tag "Listado de documentos:" %>
                          <%= text_area_tag "dni_list","", {:class => "form-control"}  %>
                        </div>    
                        <div class="form-group">  
                          <%= label_tag "Estado:" %>
                          <%= select_tag "state", options_for_select([ "Nuevo", "Vacunado", "Ausente"], "Nuevo"), {class: "select2 select-field form-control"}%>
                        </div>
                        <div class="form-group">  
                          <%= submit_tag "Actualizar", :class => "btn btn-secondary btn-block"%>
                        </div>
                    <% end %>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
<!-- /.container-fluid -->


<script type="text/javascript">


  $("#select_locality_list").select2({
    theme: "bootstrap",
    width: '100%',
    allowClear: false
  });

  $("#population_group_list").select2({
    theme: "bootstrap",
    width: '100%',
    allowClear: false
  }); 

  $("#state_list").select2({
    theme: "bootstrap",
    width: '100%',
    allowClear: false
  });  

  $("#list_generator_button").on("click", listGenerator);



  


  function listGenerator(){
    locality_select = $('#select_locality_list');
    population_group_select = $('#population_group_list');
    state_select = $('#state_list');
    age_min_select = $('#age_min');

    if (locality_select.val().length === 0){
      locality = "Todas";
    }else{
      locality = locality_select.val();
    } 

    if (population_group_select.val().length === 0){
      population_group = "Todos";
    }else{
      population_group = population_group_select.val();
    }     

    if (state_select.val().length === 0){
      state = "Todos";
    }else{
      state = state_select.val();
    } 

    if (age_min_select.val().length === 0){
      age_min = "18";
    }else{
      age_min = age_min_select.val();
    } 

    window.location.href = '/list_group_state/'+locality+'/'+population_group+'/'+ state +'/'+age_min
    
  }

</script>